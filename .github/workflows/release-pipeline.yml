name: Release Pipeline

on:
  push:
    branches:
      - main
    paths:
      - 'statscan/**'
      - 'pyproject.toml'
      - 'requirements*.txt'
      - 'setup.py'

jobs:
  qa-qc:
    uses: ./.github/workflows/qa-qc-checks.yml
    secrets: inherit
    with:
      build-required: true
      python-versions: '["3.11", "3.12"]'

  prepare-changelog:
    needs: qa-qc
    runs-on: ubuntu-latest
    steps:
      - name: Prepare changelog
        run: echo "Prepare changelog logic here"

  publish-to-pypi:
    needs: prepare-changelog
    runs-on: ubuntu-latest
    steps:
      - name: Publish to PyPI
        run: echo "PyPI publish logic here"

  create-github-release:
    needs: publish-to-pypi
    runs-on: ubuntu-latest
    steps:
      - name: Create GitHub Release
        run: echo "GitHub release logic here"

  rollback-changelog:
    if: failure()
    needs: [prepare-changelog, publish-to-pypi, create-github-release]
    runs-on: ubuntu-latest
    steps:
      - name: Rollback changelog update
        run: echo "Rollback changelog logic here"

  rollback-main:
    if: failure()
    needs: [publish-to-pypi, create-github-release]
    runs-on: ubuntu-latest
    steps:
      - name: Rollback main branch
        run: echo "Rollback main branch logic here"